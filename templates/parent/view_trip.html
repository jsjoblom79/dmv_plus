{% extends 'base.html' %}

{% block title %}Trip Details - DMV+{% endblock %}

{% block content %}
<div class="container">
    <div style="margin-bottom: 20px;">
        <a href="{% url 'view_student' student.id %}" style="color: #4CAF50;">‚Üê Back to {{ student.first_name }}'s Profile</a>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
        <div>
            <h1 style="margin-bottom: 5px;">Trip Details</h1>
            <p style="color: #666; margin: 0;">{{ student.first_name }} {{ student.last_name }}</p>
        </div>
        <div style="display: flex; gap: 10px;">
            {% if not trip.is_approved %}
                <a href="{% url 'approve_trip' trip.trip_id %}" style="display: inline-block; padding: 8px 16px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 4px;">
                    ‚úì Approve
                </a>
                <a href="{% url 'edit_trip' trip.trip_id %}" style="display: inline-block; padding: 8px 16px; background-color: #2196F3; color: white; text-decoration: none; border-radius: 4px;">
                    Edit
                </a>
                <a href="{% url 'delete_trip' trip.trip_id %}" style="display: inline-block; padding: 8px 16px; background-color: #f44336; color: white; text-decoration: none; border-radius: 4px;">
                    Delete
                </a>
            {% else %}
                <span style="display: inline-block; padding: 8px 16px; background-color: #4CAF50; color: white; border-radius: 4px;">
                    ‚úì Approved (Read-Only)
                </span>
            {% endif %}
        </div>
    </div>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if trip.is_approved %}
        <div class="message success" style="margin-bottom: 20px;">
            <strong>‚úì Approved:</strong> This trip has been approved and is now counted toward {{ student.first_name }}'s driving hours. It can no longer be edited or deleted.
        </div>
    {% endif %}

    <!-- Trip Summary -->
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
        <h2>Summary</h2>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
            <div>
                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">Duration</p>
                <p style="margin: 5px 0; font-size: 1.5em; font-weight: bold; color: #4CAF50;">
                    {{ trip.duration }} minutes
                </p>
                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">
                    ({{ trip.duration|floatformat:0|add:"0"|floatformat:2 }} hours)
                </p>
            </div>
            <div>
                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">Type</p>
                <p style="margin: 5px 0; font-size: 1.5em; font-weight: bold;">
                    {% if trip.is_night %}
                        <span style="color: #FF9800;">üåô Night Driving</span>
                    {% else %}
                        <span style="color: #2196F3;">‚òÄÔ∏è Day Driving</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- Trip Details -->
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
        <h2>Time Information</h2>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
            <div>
                <p style="margin: 5px 0; color: #666;"><strong>Start Time:</strong></p>
                <p style="margin: 5px 0;">{{ trip.start_time|date:"l, F d, Y" }}</p>
                <p style="margin: 5px 0;">{{ trip.start_time|time:"g:i A" }}</p>
            </div>
            <div>
                <p style="margin: 5px 0; color: #666;"><strong>End Time:</strong></p>
                <p style="margin: 5px 0;">{{ trip.end_time|date:"l, F d, Y" }}</p>
                <p style="margin: 5px 0;">{{ trip.end_time|time:"g:i A" }}</p>
            </div>
        </div>
    </div>

    <!-- Additional Information -->
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 4px;">
        <h2>Additional Information</h2>
        <div style="margin-top: 15px;">
            <p style="margin: 10px 0;">
                <strong>Logged By:</strong> {{ trip.parent.user.get_full_name }}
            </p>
            <p style="margin: 10px 0;">
                <strong>Created:</strong> {{ trip.created_at|date:"M d, Y - g:i A" }}
            </p>
            <p style="margin: 10px 0;">
                <strong>Status:</strong>
                {% if trip.is_approved %}
                    <span style="color: #4CAF50; font-weight: bold;">‚úì Approved</span>
                {% else %}
                    <span style="color: #FF9800; font-weight: bold;">‚è≥ Pending Approval</span>
                {% endif %}
            </p>
            <p style="margin: 10px 0;">
                <strong>Trip ID:</strong> {{ trip.trip_id }}
            </p>
        </div>
    </div>
</div>
{% endblock %}